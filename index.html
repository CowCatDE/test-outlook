<!DOCTYPE html>
<html>
<head>
    <title>Outlook Add-In</title>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <script>
        Office.onReady(function (info) {
            console.log('Office ist bereit:', info);
            
            if (info.host === Office.HostType.Outlook) {
                console.log('Outlook Add-In geladen');

                // Button zum Empfänger anzeigen
                document.getElementById("loadRecipientsButton").addEventListener("click", function () {
                    // Empfänger-Datenstruktur
                    const recipients = {
                        to: [],
                        cc: [],
                        bcc: []
                    };

                    // Abrufen der 'To'-Empfänger
                    Office.context.mailbox.item.to.getAsync(function(result) {
                        if (result.status === Office.AsyncResultStatus.Succeeded) {
                            recipients.to = result.value;
                        } else {
                            console.log("Fehler beim Abrufen der Empfänger (To): " + result.error.message);
                        }

                        // Abrufen der 'CC'-Empfänger
                        Office.context.mailbox.item.cc.getAsync(function(result) {
                            if (result.status === Office.AsyncResultStatus.Succeeded) {
                                recipients.cc = result.value;
                            } else {
                                console.log("Fehler beim Abrufen der Empfänger (CC): " + result.error.message);
                            }

                            // Abrufen der 'BCC'-Empfänger
                            Office.context.mailbox.item.bcc.getAsync(function(result) {
                                if (result.status === Office.AsyncResultStatus.Succeeded) {
                                    recipients.bcc = result.value;
                                } else {
                                    console.log("Fehler beim Abrufen der Empfänger (BCC): " + result.error.message);
                                }

                                // Sobald alle Empfänger abgerufen wurden, Anzeige im div
                                const jsonResult = JSON.stringify(recipients, null, 2); // Formatierte Ausgabe
                                document.getElementById("recipientsDiv").textContent = jsonResult; // Ausgabe im div
                                
                                // Aktivieren des Absende-Buttons
                                document.getElementById("sendEmailButton").disabled = false;
                            });
                        });
                    });
                });

                // Button zum Absenden der E-Mail
                document.getElementById("sendEmailButton").addEventListener("click", function () {
                    console.log('Absenden der E-Mail...');
                    // HTML-Inhalt aus dem textarea holen
                    const htmlContent = document.getElementById("emailBodyTextarea").value;

                    // E-Mail-Inhalt und Empfänger festlegen
                    const subject = "Beispiel-Betreff";

                    // Abrufen der Empfänger und Absenden der E-Mail
                    Office.context.mailbox.item.to.getAsync(function(result) {
                        console.log('Absenden der E-Mail... 2');
                        if (result.status === Office.AsyncResultStatus.Succeeded) {
                            console.log('Absenden der E-Mail... 3');
                            // Empfänger in der "To"-Liste
                            let toRecipients = result.value;

                            // E-Mail absenden
                            Office.context.mailbox.item.replyAllAsync(htmlContent, { 
                                subject: subject, 
                                toRecipients: toRecipients 
                            }, function (asyncResult) {
                                console.log('Absenden der E-Mail...4');
                                if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
                                    console.log("E-Mail erfolgreich gesendet!");
                                } else {
                                    console.log("Fehler beim Senden der E-Mail: " + asyncResult.error.message);
                                }
                            });
                        } else {
                            console.log("Fehler beim Abrufen der Empfänger: " + result.error.message);
                        }
                    });
                });
            }
        });
    </script>
</head>
<body>
    <h1>Outlook Add-In V3</h1>
    <p>Dieses Add-In zeigt Empfängerinformationen an und ermöglicht das Absenden einer E-Mail mit HTML-Inhalt.</p>

    <!-- Button zum Abrufen der Empfänger -->
    <button id="loadRecipientsButton">Empfänger anzeigen</button>

    <!-- Div zur Anzeige der Empfänger als JSON -->
    <div id="recipientsDiv" style="white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; margin-top: 20px;">
        <!-- Hier wird das JSON angezeigt -->
    </div>

    <!-- Textarea für den HTML-Inhalt der E-Mail -->
    <h3>Geben Sie den HTML-Body der E-Mail ein:</h3>
    <textarea id="emailBodyTextarea" rows="10" cols="50" placeholder="Geben Sie den HTML-Inhalt der E-Mail hier ein..."></textarea>

    <br><br>
    <!-- Button zum Absenden der E-Mail -->
    <button id="sendEmailButton" disabled>Absenden</button>
</body>
</html>
