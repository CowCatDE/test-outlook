<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML Anhängen</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>
<body>
  <h1>HTML-Inhalt anhängen</h1>
  <textarea id="htmlContent" rows="10" cols="50" placeholder="Gib hier den HTML-Inhalt ein..."></textarea><br><br>
  <button id="sendButton">E-Mail senden</button>

  <script>
    Office.onReady(function (info) {
        document.getElementById('sendButton').onclick = function() {
          // Hole den HTML-Inhalt aus dem Textfeld
          var htmlContent = document.getElementById('htmlContent').value;
    
          // Wenn Inhalt eingegeben wurde
          if (htmlContent.trim() !== '') {
            // Verwende das Office-JavaScript-API, um den HTMLBody der E-Mail zu setzen
            Office.context.mailbox.item.body.setAsync(htmlContent, { coercionType: Office.CoercionType.Html }, function(asyncResult) {
              if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
                // Sende die E-Mail nach dem Hinzufügen des HTML-Inhalts
                Office.context.mailbox.item.saveAsync(function(saveResult) {
                  if (saveResult.status === Office.AsyncResultStatus.Succeeded) {
                    Office.context.mailbox.item.send();
                  } else {
                    alert('Fehler beim Speichern der E-Mail: ' + saveResult.error.message);
                  }
                });
              } else {
                alert('Fehler beim Hinzufügen des HTML-Inhalts: ' + asyncResult.error.message);
              }
            });
          } else {
            alert('Kein HTML-Inhalt eingegeben. E-Mail wird ohne Anhänge gesendet.');
            // Sende die E-Mail ohne Anhängen des HTML-Inhalts
            Office.context.mailbox.item.send();
          }
        };
    })
  </script>
</body>
</html>





<!DOCTYPE html>
<html>
<head>
    <title>Outlook Add-In</title>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <script>
        Office.onReady(function (info) {
            console.log("ItemType: ", Office.context.mailbox.item.itemType);
            console.log('Office ist bereit:', info);
            let accessToken = '';
            Office.context.auth.getAccessTokenAsync((result) => {
                if (result.status === Office.AsyncResultStatus.Succeeded) {
                    accessToken = result.value;
                    console.log("Access Token:", accessToken);
                    // Hier kannst du das Token weiterverwenden, z. B. für Microsoft Graph API
                } else {
                    console.error("Fehler beim Abrufen des Tokens:", result.error.message);
                }
            });
            
            if (info.host === Office.HostType.Outlook) {
                console.log('Outlook Add-In geladen');

                // Funktion zum Laden der Empfänger
                function loadRecipients() {
                    console.log("Lade Empfänger...");
                    
                    const recipients = { to: [], cc: [], bcc: [] };
                    
                    if (!Office.context.mailbox.item) {
                        console.error("Kein E-Mail-Element verfügbar.");
                        return;
                    }

                    Office.context.mailbox.item.to.getAsync(function(result) {
                        if (result.status === Office.AsyncResultStatus.Succeeded) {
                            recipients.to = result.value.map(e => e.emailAddress);
                        }

                        Office.context.mailbox.item.cc.getAsync(function(result) {
                            if (result.status === Office.AsyncResultStatus.Succeeded) {
                                recipients.cc = result.value.map(e => e.emailAddress);
                            }

                            Office.context.mailbox.item.bcc.getAsync(function(result) {
                                if (result.status === Office.AsyncResultStatus.Succeeded) {
                                    recipients.bcc = result.value.map(e => e.emailAddress);
                                }

                                document.getElementById("recipientsDiv").textContent = JSON.stringify(recipients, null, 2);
                                document.getElementById("sendEmailButton").disabled = false;
                            });
                        });
                    });
                }

                // Funktion zum Senden der E-Mail
                function sendEmail() {
                    console.log('Starte Versand...');
                    
                    const htmlContent = document.getElementById("emailBodyTextarea").value;
      
                    const endpoint = 'https://graph.microsoft.com/v1.0/me/sendMail';
                    const email = {
                        message: {
                            subject: 'Betreff der E-Mail',
                            body: {
                                contentType: 'html',
                                content: htmlContent
                            },
                            toRecipients: [
                                {
                                    emailAddress: {
                                        address: 'moritz.bergmann@cgi.com'
                                    }
                                }
                            ]
                        }
                    };
                    
                    fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(email)
                    })
                    .then(response => {
                        if (response.ok) {
                            console.log('E-Mail erfolgreich gesendet');
                        } else {
                            console.error('Fehler beim Senden der E-Mail');
                        }
                    })
                    .catch(error => {
                        console.error('Netzwerkfehler:', error);
                    });
                }

                // Event-Listener für die Buttons
                document.getElementById("loadRecipientsButton").addEventListener("click", loadRecipients);
                document.getElementById("sendEmailButton").addEventListener("click", sendEmail);
            }
        });
    </script>
</head>
<body>
    <h1>Outlook Add-In V4</h1>
    <p>Empfänger anzeigen und HTML-E-Mail versenden.</p>

    <!-- Button zum Abrufen der Empfänger -->
    <button id="loadRecipientsButton">Empfänger anzeigen</button>

    <!-- Anzeige der Empfänger -->
    <div id="recipientsDiv" style="white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; margin-top: 20px;">
        <!-- Hier wird das JSON angezeigt -->
    </div>

    <!-- Textarea für HTML-Inhalt -->
    <h3>Geben Sie den HTML-Body der E-Mail ein:</h3>
    <textarea id="emailBodyTextarea" rows="10" cols="50" placeholder="Geben Sie den HTML-Inhalt der E-Mail hier ein..."></textarea>

    <br><br>
    <!-- Button zum Absenden -->
    <button id="sendEmailButton" disabled>Absenden</button>
</body>
</html>
